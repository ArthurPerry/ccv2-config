"use strict";(self.webpackChunkb2bspastore=self.webpackChunkb2bspastore||[]).push([[809],{8849:(mt,b,C)=>{C.d(b,{D:()=>n});var c=C(1177);function n(d){return _=>_.lift(new E(d))}class E{constructor(_){this.durationSelector=_}call(_,I){return I.subscribe(new o(_,this.durationSelector))}}class o extends c.Ds{constructor(_,I){super(_),this.durationSelector=I,this.hasValue=!1}_next(_){try{const I=this.durationSelector.call(this,_);I&&this._tryNext(_,I)}catch(I){this.destination.error(I)}}_complete(){this.emitValue(),this.destination.complete()}_tryNext(_,I){let A=this.durationSubscription;this.value=_,this.hasValue=!0,A&&(A.unsubscribe(),this.remove(A)),A=(0,c.ft)(I,new c.IY(this)),A&&!A.closed&&this.add(this.durationSubscription=A)}notifyNext(){this.emitValue()}notifyComplete(){this.emitValue()}emitValue(){if(this.hasValue){const _=this.value,I=this.durationSubscription;I&&(this.durationSubscription=void 0,I.unsubscribe(),this.remove(I)),this.value=void 0,this.hasValue=!1,super._next(_)}}}},9184:(mt,b,C)=>{C.d(b,{g:()=>n});var c=C(5778);function n(E,o){return(0,c.x)((d,_)=>o?o(d[E],_[E]):d[E]===_[E])}},8809:(mt,b,C)=>{C.d(b,{$:()=>tr,CQ:()=>Dt,Eu:()=>pe,F5:()=>Ir,F7:()=>Mt,Jp:()=>Fr,N4:()=>l,Qx:()=>Or,T6:()=>m,YA:()=>Ur,YW:()=>De,i4:()=>Lr,n5:()=>Fe,r_:()=>we,vI:()=>le,xb:()=>G});var c=C(4650),n=C(9057),E=C(8555),o=C(3749),d=C(4850),_=C(1406),I=C(7221),A=C(1709),Be=C(4002),S=C(7545),g=C(7168),p=C(2198),Ne=C(9184),U=C(2994),f=C(2986),Z=C(2313),M=C(5778),Pt=C(5154),ke=C(519),Ye=C(8849),T=C(5254),D=C(1086),tt=C(2654),We=C(5409),N=C(6053),Ke=C(839),je=C(8723),He=C(8896),h=C(5024),et=C(655),ze=C(3125),Xe=C(6538),Qe=C(6895),Je=C(610);const l="[Multi Cart] Multi Cart Data",P="addVoucher",k="[Cart-entry] Add Entry",w="[Cart-entry] Add Entry Success",Y="[Cart-entry] Add Entry Fail",rt="[Cart-entry] Remove Entry",W="[Cart-entry] Remove Entry Success",st="[Cart-entry] Remove Entry Fail",at="[Cart-entry] Update Entry",K="[Cart-entry] Update Entry Success",it="[Cart-entry] Update Entry Fail";class nt extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=k}}class ct extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=w}}class ot extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=Y}}class Ut extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=rt}}class Lt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=W}}class Ot extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=st}}class Vt extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=at}}class Gt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=K}}class xt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=it}}const j="[Cart-voucher] Add Cart Vouchers",bt="[Cart-voucher] Add Cart Voucher Fail",dt="[Cart-voucher] Add Cart Voucher Success",wt="[Cart-voucher] Reset Add Cart Voucher",ut="[Cart-voucher] Remove Cart Voucher",$t="[Cart-voucher] Remove Cart Voucher Fail",Ct="[Cart-voucher] Remove Cart Voucher Success";class Bt extends n.kPG.EntityLoadAction{constructor(s){super(n.BzF,P),this.payload=s,this.type=j}}class Nt extends n.kPG.EntityFailAction{constructor(s){super(n.BzF,P,s.error),this.payload=s,this.type=bt}}class kt extends n.kPG.EntitySuccessAction{constructor(s){super(n.BzF,P),this.payload=s,this.type=dt}}class Yt extends n.kPG.EntityLoaderResetAction{constructor(){super(n.BzF,P),this.type=wt}}class Wt extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=ut}}class Kt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=$t}}class jt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=Ct}}const L="[Cart] Create Cart",ht="[Cart] Create Cart Fail",O="[Cart] Create Cart Success",$="[Cart] Load Cart",Ht="[Cart] Load Cart Fail",F="[Cart] Load Cart Success",Et="[Cart] Load Carts Success",lt="[Cart] Add Email to Cart",zt="[Cart] Add Email to Cart Fail",Xt="[Cart] Add Email to Cart Success",vt="[Cart] Merge Cart",Qt="[Cart] Merge Cart Success",Jt="[Cart] Reset Cart Details",pt="[Cart] Remove Cart",H="[Cart] Delete Cart",z="[Cart] Delete Cart Success",It="[Cart] Delete Cart Fail";class _t extends n.kPG.EntityLoadAction{constructor(s){super(l,s.tempCartId),this.payload=s,this.type=L}}class qt extends n.kPG.EntityFailAction{constructor(s){super(l,s.tempCartId),this.payload=s,this.type=ht}}class Zt extends n.kPG.EntitySuccessAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=O}}class te extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=lt}}class ee extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=zt}}class re extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=Xt}}class y extends n.kPG.EntityLoadAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=$}}class St extends n.kPG.EntityFailAction{constructor(s){super(l,s.cartId,s.error),this.payload=s,this.type=Ht}}class se extends n.kPG.EntitySuccessAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=F}}class ae{constructor(s){this.payload=s,this.type=vt}}class ie extends n.kPG.EntityRemoveAction{constructor(s){super(l,s.oldCartId),this.payload=s,this.type=Qt}}class ne extends n.kPG.ProcessesLoaderResetAction{constructor(){super(l),this.type=Jt}}class B extends n.kPG.EntityRemoveAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=pt}}class ce{constructor(s){this.payload=s,this.type=H}}class oe extends n.kPG.EntityRemoveAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=z}}class de{constructor(s){this.payload=s,this.type=It}}const ue="[Cart] Cart Processes Increment",Ce="[Cart] Cart Processes Decrement",X="[Cart] Set Active Cart Id",gt="[Cart] Clear Cart State",At="[Cart] Set cart type index",ft="[Cart] Set cart data";class he extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(l,s),this.payload=s,this.type=ue}}class yt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(l,s),this.payload=s,this.type=Ce}}class Rt{constructor(s){this.payload=s,this.type=X}}class Ee extends n.kPG.EntityRemoveAllAction{constructor(){super(l),this.type=gt}}class V{constructor(s){this.payload=s,this.type=At}}var tr=Object.freeze({__proto__:null,CART_ADD_ENTRY:k,CART_ADD_ENTRY_SUCCESS:w,CART_ADD_ENTRY_FAIL:Y,CART_REMOVE_ENTRY:rt,CART_REMOVE_ENTRY_SUCCESS:W,CART_REMOVE_ENTRY_FAIL:st,CART_UPDATE_ENTRY:at,CART_UPDATE_ENTRY_SUCCESS:K,CART_UPDATE_ENTRY_FAIL:it,CartAddEntry:nt,CartAddEntrySuccess:ct,CartAddEntryFail:ot,CartRemoveEntry:Ut,CartRemoveEntrySuccess:Lt,CartRemoveEntryFail:Ot,CartUpdateEntry:Vt,CartUpdateEntrySuccess:Gt,CartUpdateEntryFail:xt,CART_ADD_VOUCHER:j,CART_ADD_VOUCHER_FAIL:bt,CART_ADD_VOUCHER_SUCCESS:dt,CART_RESET_ADD_VOUCHER:wt,CART_REMOVE_VOUCHER:ut,CART_REMOVE_VOUCHER_FAIL:$t,CART_REMOVE_VOUCHER_SUCCESS:Ct,CartAddVoucher:Bt,CartAddVoucherFail:Nt,CartAddVoucherSuccess:kt,CartResetAddVoucher:Yt,CartRemoveVoucher:Wt,CartRemoveVoucherFail:Kt,CartRemoveVoucherSuccess:jt,CREATE_CART:L,CREATE_CART_FAIL:ht,CREATE_CART_SUCCESS:O,LOAD_CART:$,LOAD_CART_FAIL:Ht,LOAD_CART_SUCCESS:F,LOAD_CARTS_SUCCESS:Et,ADD_EMAIL_TO_CART:lt,ADD_EMAIL_TO_CART_FAIL:zt,ADD_EMAIL_TO_CART_SUCCESS:Xt,MERGE_CART:vt,MERGE_CART_SUCCESS:Qt,RESET_CART_DETAILS:Jt,REMOVE_CART:pt,DELETE_CART:H,DELETE_CART_SUCCESS:z,DELETE_CART_FAIL:It,CreateCart:_t,CreateCartFail:qt,CreateCartSuccess:Zt,AddEmailToCart:te,AddEmailToCartFail:ee,AddEmailToCartSuccess:re,LoadCart:y,LoadCartFail:St,LoadCartSuccess:se,LoadCartsSuccess:class qe extends n.kPG.EntitySuccessAction{constructor(s){super(l,s.map(t=>t?.code??"")),this.payload=s,this.type=Et}},MergeCart:ae,MergeCartSuccess:ie,ResetCartDetails:ne,RemoveCart:B,DeleteCart:ce,DeleteCartSuccess:oe,DeleteCartFail:de,CART_PROCESSES_INCREMENT:ue,CART_PROCESSES_DECREMENT:Ce,SET_ACTIVE_CART_ID:X,CLEAR_CART_STATE:gt,SET_CART_TYPE_INDEX:At,SET_CART_DATA:ft,CartProcessesIncrement:he,CartProcessesDecrement:yt,SetActiveCartId:Rt,ClearCartState:Ee,SetCartTypeIndex:V,SetCartData:class Ze extends n.kPG.EntitySuccessAction{constructor(s){super(l,s.cartId),this.payload=s,this.type=ft}}});class le{}let ve=(()=>{class e{constructor(t){this.adapter=t}add(t,a,r,i){return this.adapter.add(t,a,r,i)}update(t,a,r,i,u){return this.adapter.update(t,a,r,i,u)}remove(t,a,r){return this.adapter.remove(t,a,r)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(le))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),er=(()=>{class e{constructor(t,a){this.actions$=t,this.cartEntryConnector=a,this.contextChange$=this.actions$.pipe((0,h.l4)(n.dO9.CURRENCY_CHANGE,n.dO9.LANGUAGE_CHANGE)),this.addEntry$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(k),(0,d.U)(r=>r.payload),(0,_.b)(r=>this.cartEntryConnector.add(r.userId,r.cartId,r.productCode,r.quantity).pipe((0,d.U)(i=>new ct({...r,...i})),(0,I.K)(i=>(0,T.D)([new ot({...r,error:(0,n.cxH)(i)}),new y({cartId:r.cartId,userId:r.userId})])))),(0,n.FM_)(this.contextChange$))),this.removeEntry$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(rt),(0,d.U)(r=>r.payload),(0,_.b)(r=>this.cartEntryConnector.remove(r.userId,r.cartId,r.entryNumber).pipe((0,d.U)(()=>new Lt({...r})),(0,I.K)(i=>(0,T.D)([new Ot({...r,error:(0,n.cxH)(i)}),new y({cartId:r.cartId,userId:r.userId})])))),(0,n.FM_)(this.contextChange$))),this.updateEntry$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(at),(0,d.U)(r=>r.payload),(0,_.b)(r=>this.cartEntryConnector.update(r.userId,r.cartId,r.entryNumber,r.quantity).pipe((0,d.U)(()=>new Gt({...r})),(0,I.K)(i=>(0,T.D)([new xt({...r,error:(0,n.cxH)(i)}),new y({cartId:r.cartId,userId:r.userId})])))),(0,n.FM_)(this.contextChange$)))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(h.eX),c.LFG(ve))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();class pe{}let Ie=(()=>{class e{constructor(t){this.adapter=t}add(t,a,r){return this.adapter.add(t,a,r)}remove(t,a,r){return this.adapter.remove(t,a,r)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(pe))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),rr=(()=>{class e{constructor(t,a,r){this.actions$=t,this.cartVoucherConnector=a,this.messageService=r,this.addCartVoucher$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(j),(0,d.U)(i=>i.payload),(0,A.zg)(i=>this.cartVoucherConnector.add(i.userId,i.cartId,i.voucherId).pipe((0,d.U)(()=>(this.showGlobalMessage("voucher.applyVoucherSuccess",i.voucherId,n.xUg.MSG_TYPE_CONFIRMATION),new kt({...i}))),(0,I.K)(u=>(0,T.D)([new Nt({...i,error:(0,n.cxH)(u)}),new yt(i.cartId),new y({userId:i.userId,cartId:i.cartId})])))))),this.removeCartVoucher$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(ut),(0,d.U)(i=>i.payload),(0,A.zg)(i=>this.cartVoucherConnector.remove(i.userId,i.cartId,i.voucherId).pipe((0,d.U)(()=>(this.showGlobalMessage("voucher.removeVoucherSuccess",i.voucherId,n.xUg.MSG_TYPE_INFO),new jt({userId:i.userId,cartId:i.cartId,voucherId:i.voucherId}))),(0,I.K)(u=>(0,T.D)([new Kt({error:(0,n.cxH)(u),cartId:i.cartId,userId:i.userId,voucherId:i.voucherId}),new y({userId:i.userId,cartId:i.cartId})]))))))}showGlobalMessage(t,a,r){this.messageService.add({key:t,params:{voucherCode:a}},r)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(h.eX),c.LFG(Ie),c.LFG(n.IWp))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();function m(e,s){return s===n.Fds?e?.guid??"":e?.code??""}function Mt(e=""){return e.startsWith("selectivecart")}function _e(e){return"notFound"===e.reason&&"cart"===e.subjectType&&!Mt(e.subject)}function ir(e){return"VoucherOperationError"===e.type}function nr(e){return"CartError"===e.type||"CartAddressError"===e.type||"CartEntryError"===e.type||"CartEntryGroupError"===e.type}function Se(e){return e.startsWith("temp-")}function G(e){return!e||"object"==typeof e&&0===Object.keys(e).length}const Q=(0,E.ZF)("cart"),x=(0,E.P1)(Q,e=>e.carts),ge=e=>(0,E.P1)(x,s=>n.kPG.entityProcessesLoaderStateSelector(s,e)),Tt=e=>(0,E.P1)(x,s=>n.kPG.entityValueSelector(s,e)),Ae=e=>(0,E.P1)(x,s=>n.kPG.entityIsStableSelector(s,e)),fe=e=>(0,E.P1)(x,s=>n.kPG.entityHasPendingProcessesSelector(s,e)),J=e=>(0,E.P1)(Tt(e),s=>s&&s.entries?s.entries:[]),ye=(e,s)=>(0,E.P1)(J(e),t=>t.find(a=>a.product?.code===s)),Re=(0,E.P1)(x,e=>Object.keys(e.entities).map(s=>n.kPG.entityValueSelector(e,s))),Me=(0,E.P1)(Q,e=>e.index),Te=e=>(0,E.P1)(Me,s=>s&&s[e]);class De{}let Dt=(()=>{class e{constructor(t){this.adapter=t}loadAll(t){return this.adapter.loadAll(t)}load(t,a){return this.adapter.load(t,a)}create(t,a,r){return this.adapter.create(t,a,r)}delete(t,a){return this.adapter.delete(t,a)}save(t,a,r,i){return this.adapter.save(t,a,r,i)}addEmail(t,a,r){return this.adapter.addEmail(t,a,r)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(De))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const dr=[er,rr,(()=>{class e{constructor(t,a,r){this.actions$=t,this.cartConnector=a,this.store=r,this.contextChange$=this.actions$.pipe((0,h.l4)(n.dO9.CURRENCY_CHANGE,n.dO9.LANGUAGE_CHANGE)),this.loadCart$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)($),(0,d.U)(i=>i.payload),(0,Be.v)(i=>i.cartId),(0,A.zg)(i=>i.pipe((0,S.w)(u=>(0,D.of)(u).pipe((0,g.M)(this.store.pipe((0,E.Ys)(fe(u.cartId)))))),(0,p.h)(([u,v])=>!v),(0,d.U)(([u])=>u),(0,S.w)(u=>this.cartConnector.load(u.userId,u.cartId).pipe((0,A.zg)(v=>{let R=[];return v?(R.push(new se({...u,cart:v,cartId:m(v,u.userId)})),u.cartId===n.gSv&&R.push(new B({cartId:n.gSv}))):R=[new St({...u,error:{}})],R}),(0,I.K)(v=>{if(v?.error?.errors){if(v.error.errors.filter(q=>"invalid"===q.reason).length>0)return(0,D.of)(new y({...u}));if(v.error.errors.filter(q=>_e(q)||"UnknownResourceError"===q.reason).length>0)return(0,D.of)(new B({cartId:u.cartId}))}return(0,D.of)(new St({...u,error:(0,n.cxH)(v)}))}))))),(0,n.FM_)(this.contextChange$))),this.createCart$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(L),(0,d.U)(i=>i.payload),(0,A.zg)(i=>this.cartConnector.create(i.userId,i.oldCartId,i.toMergeCartGuid).pipe((0,S.w)(u=>{const v=[];return i.oldCartId&&v.push(new ie({extraData:i.extraData,userId:i.userId,tempCartId:i.tempCartId,cartId:m(u,i.userId),oldCartId:i.oldCartId})),[new Zt({...i,cart:u,cartId:m(u,i.userId)}),new B({cartId:i.tempCartId}),...v]}),(0,I.K)(u=>(0,D.of)(new qt({...i,error:(0,n.cxH)(u)}))))),(0,n.FM_)(this.contextChange$))),this.mergeCart$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(vt),(0,d.U)(i=>i.payload),(0,S.w)(i=>this.cartConnector.load(i.userId,n.gSv).pipe((0,d.U)(u=>{if(u?.code!==i.cartId)return new _t({userId:i.userId,oldCartId:i.cartId,toMergeCartGuid:u?u.guid:void 0,extraData:i.extraData,tempCartId:i.tempCartId})}),(0,p.h)(n.pTN))),(0,n.FM_)(this.contextChange$))),this.refresh$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(dt),(0,d.U)(i=>i.payload),(0,_.b)(i=>(0,T.D)([new yt(i.cartId),new y({userId:i.userId,cartId:i.cartId})])))),this.refreshWithoutProcesses$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(w,W,K,Ct),(0,d.U)(i=>i.payload),(0,d.U)(i=>new y({userId:i.userId,cartId:i.cartId})))),this.resetCartDetailsOnSiteContextChange$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(n.dO9.LANGUAGE_CHANGE,n.dO9.CURRENCY_CHANGE),(0,A.zg)(()=>[new ne]))),this.addEmail$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(lt),(0,d.U)(i=>i.payload),(0,A.zg)(i=>this.cartConnector.addEmail(i.userId,i.cartId,i.email).pipe((0,A.zg)(()=>[new re({...i}),new y({userId:i.userId,cartId:i.cartId})]),(0,I.K)(u=>(0,T.D)([new ee({...i,error:(0,n.cxH)(u)}),new y({userId:i.userId,cartId:i.cartId})])))),(0,n.FM_)(this.contextChange$))),this.deleteCart$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(H),(0,d.U)(i=>i.payload),(0,A.zg)(i=>this.cartConnector.delete(i.userId,i.cartId).pipe((0,d.U)(()=>new oe({...i})),(0,I.K)(u=>(0,T.D)([new de({...i,error:(0,n.cxH)(u)}),new y({...i})]))))))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(h.eX),c.LFG(Dt),c.LFG(E.yh))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),(()=>{class e{constructor(t){this.actions$=t,this.processesIncrement$=this.actions$.pipe((0,h.l4)(j),(0,d.U)(a=>a.payload),(0,d.U)(a=>new he(a.cartId))),this.setSelectiveId$=this.actions$.pipe((0,h.l4)(F),(0,d.U)(a=>{switch(a.type){case F:{const r=a.payload;if(Mt(r.cartId))return new V({cartType:o.EI.SELECTIVE,cartId:r.cartId});break}}}),(0,p.h)(n.pTN)),this.setActiveCartId$=this.actions$.pipe((0,h.l4)(F,$,O,L,X),(0,d.U)(a=>{switch(a.type){case $:if(a?.payload?.cartId===n.gSv)return new V({cartType:o.EI.ACTIVE,cartId:""});break;case F:case L:if(a?.payload?.extraData?.active)return new V({cartType:o.EI.ACTIVE,cartId:a.meta.entityId});break;case O:return new V({cartType:a?.payload?.extraData?.active?o.EI.ACTIVE:o.EI.NEW_CREATED,cartId:a.meta.entityId});case X:return new V({cartType:o.EI.ACTIVE,cartId:a.payload})}}),(0,p.h)(n.pTN))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(h.eX))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),(0,et.gn)([(0,h.Qm)()],e.prototype,"processesIncrement$",void 0),(0,et.gn)([(0,h.Qm)()],e.prototype,"setSelectiveId$",void 0),(0,et.gn)([(0,h.Qm)()],e.prototype,"setActiveCartId$",void 0),e})()],me={[o.EI.ACTIVE]:""};function ur(e=me,s){switch(s.type){case At:return{...e,[s.payload.cartType]:s.payload.cartId};case pt:case z:return s.payload?.cartId===e[o.EI.ACTIVE]?{...e,[o.EI.ACTIVE]:""}:e;case gt:return me}return e}function hr(e,s){switch(s.type){case Et:return s.payload;case F:case O:case ft:return s.payload.cart}return e}const lr=[function Er(e){return function(s,t){return t.type===n.uQL.LOGOUT&&(s=void 0),e(s,t)}}],Pe=new c.OlP("MultiCartReducers"),pr={provide:Pe,useFactory:function vr(){return{carts:n.kPG.entityProcessesLoaderReducer(l,hr),index:ur}}};var Ir=Object.freeze({__proto__:null,getMultiCartState:Q,getMultiCartEntities:x,getCartEntitySelectorFactory:ge,getCartSelectorFactory:Tt,getCartIsStableSelectorFactory:Ae,getCartHasPendingProcessesSelectorFactory:fe,getCartEntriesSelectorFactory:J,getCartEntrySelectorFactory:ye,getCartsSelectorFactory:Re,getCartTypeIndex:Me,getCartIdByTypeFactory:Te});let _r=(()=>{class e{constructor(t,a,r){this.statePersistenceService=t,this.store=a,this.siteContextParamsService=r,this.subscription=new tt.w}initSync(){this.subscription.add(this.statePersistenceService.syncWithStorage({key:"cart",state$:this.getCartState(),context$:this.siteContextParamsService.getValues([n.iEg]),storageType:n.iHd.LOCAL_STORAGE,onRead:t=>this.onRead(t)}))}getCartState(){return this.store.pipe((0,p.h)(t=>!!t.cart),(0,E.Ys)(Q),(0,p.h)(t=>!!t),(0,d.U)(t=>t.index),(0,Ne.g)("Active"),(0,d.U)(t=>({active:t[o.EI.ACTIVE]??""})))}onRead(t){this.store.dispatch(new Ee),this.store.dispatch(new Rt(t?t.active:""))}ngOnDestroy(){this.subscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(n.WBb),c.LFG(E.yh),c.LFG(n.Qnj))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Sr(e,s){return()=>s.getStable("context").pipe((0,U.b)(()=>{e.initSync()})).toPromise()}function gr(){return s=>(t,a)=>{const r={...t};return"@ngrx/store/init"===a.type&&(r.cart={...r.cart,index:{[o.EI.ACTIVE]:void 0}}),s(r,a)}}let Ar=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[{provide:n.z4I,useFactory:Sr,deps:[_r,n.yUt],multi:!0},{provide:E.sr,useFactory:gr,multi:!0}]}),e})();class Fe{}let Ue=(()=>{class e{constructor(t){this.adapter=t}validate(t,a){return this.adapter.validate(t,a)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(Fe))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),fr=(()=>{class e{constructor(t,a,r,i){this.actionsSubject=t,this.event=a,this.activeCartService=r,this.stateEventService=i,this.register()}register(){this.registerCreateCart(),this.registerAddEntry(),this.registerRemoveEntry(),this.registerUpdateEntry(),this.registerDeleteCart()}registerAddEntry(){this.registerMapped({action:k,event:o.uP}),this.registerMapped({action:w,event:o.VD}),this.registerMapped({action:Y,event:o.K$})}registerRemoveEntry(){this.registerMapped({action:W,event:o.A7}),this.registerMapped({action:st,event:o.dC})}registerUpdateEntry(){this.registerMapped({action:K,event:o.X}),this.registerMapped({action:it,event:o.gI})}registerCreateCart(){this.stateEventService.register({action:L,event:o.su}),this.stateEventService.register({action:O,event:o.cA}),this.stateEventService.register({action:ht,event:o.Cj})}registerDeleteCart(){this.stateEventService.register({action:H,event:o.aY,factory:t=>(0,n.PjU)(o.aY,{...t.payload,cartCode:t.payload.cartId})}),this.stateEventService.register({action:z,event:o.N0,factory:t=>(0,n.PjU)(o.N0,{...t.payload,cartCode:t.payload.cartId})}),this.stateEventService.register({action:It,event:o.Ks,factory:t=>(0,n.PjU)(o.Ks,{...t.payload,cartCode:t.payload.cartId})})}registerMapped(t){const a=this.getAction(t.action).pipe((0,S.w)(r=>(0,D.of)(r).pipe((0,g.M)(this.activeCartService.getActive(),this.activeCartService.getActiveCartId()))),(0,p.h)(([r,i,u])=>r.payload.cartId===u),(0,d.U)(([r,i])=>(0,n.PjU)(t.event,{...r.payload,cartCode:i.code,entry:r.payload.entry?r.payload.entry:i.entries?.[Number(r.payload.entryNumber)]})));return this.event.register(t.event,a)}getAction(t){return this.actionsSubject.pipe((0,h.l4)(...[].concat(t)))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(E.UO),c.LFG(n.POd),c.LFG(o.bu),c.LFG(n.vL$))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),yr=(()=>{class e{constructor(t){}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(fr))},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({}),e})(),Rr=(()=>{class e{constructor(t){this.eventService=t,this.register()}register(){this.eventService.register(o.uB,this.buildCartPageEvent())}buildCartPageEvent(){return this.eventService.get(ze.z4w).pipe((0,p.h)(t=>"cart"===t.semanticRoute),(0,d.U)(t=>(0,n.PjU)(o.uB,{navigation:t})))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(n.POd))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Mr=(()=>{class e{constructor(t){}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(Rr))},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({}),e})(),Le=(()=>{class e{constructor(t,a){this.multiCartFacade=t,this.userIdService=a,this.subscription=new tt.w,this.activeCartId$=this.userIdService.getUserId().pipe((0,f.q)(1),(0,Z.c)(this.multiCartFacade.getCartIdByType(o.EI.ACTIVE)),(0,p.h)(r=>void 0!==r),(0,d.U)(r=>""===r?n.gSv:r)),this.cartEntity$=this.activeCartId$.pipe((0,S.w)(r=>this.multiCartFacade.getCartEntity(r))),this.checkInitLoad=void 0,this.initActiveCart(),this.detectUserChange()}initActiveCart(){const t=this.cartEntity$.pipe((0,d.U)(r=>({cart:r.value,isStable:!r.loading&&0===r.processesCount,loaded:Boolean((r.error||r.success)&&!r.loading)})),(0,p.h)(({isStable:r,cart:i})=>r||G(i))),a=t.pipe((0,g.M)(this.activeCartId$,this.userIdService.getUserId()),(0,U.b)(([{cart:r,loaded:i,isStable:u},v,R])=>{u&&G(r)&&!i&&!Se(v)&&this.load(v,R)}));this.activeCart$=(0,We.g)(()=>a.subscribe(),()=>t).pipe((0,d.U)(({cart:r})=>r||{}),(0,M.x)(),(0,Pt.d)({bufferSize:1,refCount:!0}))}detectUserChange(){this.subscription.add(this.userIdService.getUserId().pipe((0,ke.G)(),(0,g.M)(this.activeCartId$)).subscribe(([[t,a],r])=>{(function or(e,s){return e!==n.Fds&&s!==e})(a,t)&&this.loadOrMerge(r,a,t)}))}getActive(){return this.activeCart$}takeActive(){return this.isStable().pipe((0,p.h)(t=>t),(0,S.w)(()=>this.getActive()),(0,p.h)(t=>!!t),(0,f.q)(1))}getActiveCartId(){return this.activeCart$.pipe((0,g.M)(this.userIdService.getUserId()),(0,d.U)(([t,a])=>m(t,a)),(0,M.x)())}takeActiveCartId(){return this.isStable().pipe((0,p.h)(t=>t),(0,S.w)(()=>this.getActiveCartId()),(0,p.h)(t=>!!t),(0,f.q)(1))}getEntries(){return this.activeCartId$.pipe((0,S.w)(t=>this.multiCartFacade.getEntries(t)),(0,M.x)())}getLastEntry(t){return this.activeCartId$.pipe((0,S.w)(a=>this.multiCartFacade.getLastEntry(a,t)),(0,M.x)())}getLoading(){return this.cartEntity$.pipe((0,d.U)(t=>Boolean(t.loading)),(0,M.x)())}isStable(){return this.activeCartId$.pipe((0,S.w)(t=>this.multiCartFacade.isStable(t)))}load(t,a){a===n.Fds&&t===n.gSv||this.multiCartFacade.loadCart({userId:a,cartId:t,extraData:{active:!0}})}loadOrMerge(t,a,r){t===n.gSv||r!==n.Fds?this.multiCartFacade.loadCart({userId:a,cartId:t,extraData:{active:!0}}):Boolean((0,n.P51)(this.isGuestCart()))?this.guestCartMerge(t):this.multiCartFacade.mergeToCurrentCart({userId:a,cartId:t,extraData:{active:!0}})}guestCartMerge(t){this.getEntries().pipe((0,f.q)(1)).subscribe(a=>{this.multiCartFacade.deleteCart(t,n.Fds),this.addEntriesGuestMerge(a)})}addEntriesGuestMerge(t){const a=t.map(r=>({productCode:r.product?.code??"",quantity:r.quantity??0}));this.requireLoadedCart(!0).pipe((0,g.M)(this.userIdService.getUserId())).subscribe(([r,i])=>{this.multiCartFacade.addEntries(i,m(r,i),a)})}isCartCreating(t,a){return Se(a)&&(t.loading||t.success||t.error)}requireLoadedCart(t=!1){this.checkInitLoad=void 0===this.checkInitLoad;const a=(t?this.cartEntity$.pipe((0,p.h)(()=>!Boolean((0,n.P51)(this.isGuestCart())))):this.cartEntity$).pipe((0,p.h)(r=>!r.loading||!!this.checkInitLoad));return this.activeCartId$.pipe((0,g.M)(a),(0,p.h)(([r,i])=>!this.isCartCreating(i,r)),(0,d.U)(([,r])=>r),(0,f.q)(1),(0,g.M)(this.userIdService.getUserId()),(0,U.b)(([r,i])=>{G(r.value)&&i!==n.Fds&&!r.loading&&this.load(n.gSv,i),this.checkInitLoad=!1}),(0,Z.c)(a),(0,g.M)(this.userIdService.getUserId()),(0,p.h)(([r,i])=>Boolean(i===n.Fds||r.success||r.error)),(0,f.q)(1),(0,U.b)(([r,i])=>{G(r.value)&&this.multiCartFacade.createCart({userId:i,extraData:{active:!0}})}),(0,Z.c)(a),(0,p.h)(r=>r.success||r.error),(0,g.M)(this.activeCartId$),(0,p.h)(([r,i])=>!this.isCartCreating(r,i)),(0,d.U)(([r])=>r.value),(0,p.h)(r=>!G(r)),(0,f.q)(1))}addEntry(t,a){this.requireLoadedCart().pipe((0,g.M)(this.userIdService.getUserId())).subscribe(([r,i])=>{this.multiCartFacade.addEntry(i,m(r,i),t,a)})}removeEntry(t){this.activeCartId$.pipe((0,g.M)(this.userIdService.getUserId()),(0,f.q)(1)).subscribe(([a,r])=>{this.multiCartFacade.removeEntry(r,a,t.entryNumber)})}updateEntry(t,a){this.activeCartId$.pipe((0,g.M)(this.userIdService.getUserId()),(0,f.q)(1)).subscribe(([r,i])=>{this.multiCartFacade.updateEntry(i,r,t,a)})}getEntry(t){return this.activeCartId$.pipe((0,S.w)(a=>this.multiCartFacade.getEntry(a,t)),(0,M.x)())}addEmail(t){this.activeCartId$.pipe((0,g.M)(this.userIdService.getUserId()),(0,f.q)(1)).subscribe(([a,r])=>{this.multiCartFacade.assignEmail(a,r,t)})}getAssignedUser(){return this.activeCart$.pipe((0,d.U)(t=>t.user))}isGuestCart(t){return t?(0,D.of)(this.isCartUserGuest(t)):this.activeCart$.pipe((0,d.U)(a=>this.isCartUserGuest(a)),(0,M.x)())}isCartUserGuest(t){const a=t.user;return Boolean(a&&(a.name===n.YI5||function cr(e){return!!e&&!!e.match(n.QIJ)}(a.uid?.split("|").slice(1).join("|"))))}addEntries(t){const a=t.map(r=>({productCode:r.product?.code??"",quantity:r.quantity??0}));this.requireLoadedCart().pipe((0,g.M)(this.userIdService.getUserId())).subscribe(([r,i])=>{r&&this.multiCartFacade.addEntries(i,m(r,i),a)})}reloadActiveCart(){(0,N.aj)([this.getActiveCartId(),this.userIdService.takeUserId()]).pipe((0,f.q)(1),(0,d.U)(([t,a])=>{this.multiCartFacade.loadCart({cartId:t,userId:a,extraData:{active:!0}})})).subscribe()}ngOnDestroy(){this.subscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(o.WT),c.LFG(n.XBV))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),Oe=(()=>{class e{constructor(t){this.routingService=t,this.NAVIGATION_SKIPS=2,this.navigationIdCount=0,this.subscription=new tt.w,this.cartValidationResult$=new Ke.t(1),this.checkForValidationResultClear$=this.routingService.getRouterState().pipe((0,g.M)(this.cartValidationResult$),(0,U.b)(([a,r])=>{this.navigationIdCount+this.NAVIGATION_SKIPS<=a.navigationId&&r.length&&(this.cartValidationResult$.next([]),this.navigationIdCount=a.navigationId)})),this.setInitialState()}ngOnDestroy(){this.subscription.unsubscribe()}setInitialState(){this.setNavigationIdStep(),this.subscription.add(this.checkForValidationResultClear$.subscribe())}updateValidationResultAndRoutingId(t){this.cartValidationResult$.next(t),this.setNavigationIdStep()}setNavigationIdStep(){this.routingService.getRouterState().pipe((0,f.q)(1)).subscribe(t=>this.navigationIdCount=t.navigationId)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(n.Znh))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Ve=(()=>{class e{constructor(t,a,r,i,u){this.cartValidationConnector=t,this.command=a,this.userIdService=r,this.activeCartFacade=i,this.cartValidationStateService=u,this.validateCartCommand=this.command.create(()=>(0,N.aj)([this.activeCartFacade.getActiveCartId(),this.userIdService.takeUserId(),this.activeCartFacade.isStable()]).pipe((0,p.h)(([v,R,$e])=>$e),(0,f.q)(1),(0,S.w)(([v,R])=>this.cartValidationConnector.validate(v,R))),{strategy:n.flE.CancelPrevious})}validateCart(){return this.validateCartCommand.execute()}getValidationResults(){return this.cartValidationStateService.cartValidationResult$}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(Ue),c.LFG(n.VDr),c.LFG(n.XBV),c.LFG(o.bu),c.LFG(Oe))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),Ge=(()=>{class e{constructor(t,a,r){this.store=t,this.activeCartFacade=a,this.userIdService=r}addVoucher(t,a){this.combineUserAndCartId(a).subscribe(([r,i])=>this.store.dispatch(new Bt({userId:r,cartId:i,voucherId:t})))}removeVoucher(t,a){this.combineUserAndCartId(a).subscribe(([r,i])=>this.store.dispatch(new Wt({userId:r,cartId:i,voucherId:t})))}getAddVoucherResultError(){return this.store.pipe((0,E.Ys)(n.VkE.getProcessErrorFactory(P)))}getAddVoucherResultSuccess(){return this.store.pipe((0,E.Ys)(n.VkE.getProcessSuccessFactory(P)))}getAddVoucherResultLoading(){return this.store.pipe((0,E.Ys)(n.VkE.getProcessLoadingFactory(P)))}resetAddVoucherProcessingState(){this.store.dispatch(new Yt)}combineUserAndCartId(t){return t?this.userIdService.getUserId().pipe((0,f.q)(1),(0,d.U)(a=>[a,t])):(0,N.aj)([this.userIdService.getUserId(),this.activeCartFacade.getActiveCartId()]).pipe((0,f.q)(1))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(E.yh),c.LFG(o.bu),c.LFG(n.XBV))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),xe=(()=>{class e{constructor(t,a){this.store=t,this.userIdService=a}getCart(t){return this.store.pipe((0,E.Ys)(Tt(t)))}getCarts(){return this.store.pipe((0,E.Ys)(Re))}getCartEntity(t){return this.store.pipe((0,E.Ys)(ge(t)))}isStable(t){return this.store.pipe((0,E.Ys)(Ae(t)),(0,Ye.D)(a=>a?(0,je.H)(0):He.E),(0,M.x)())}generateTempCartId(){return`temp-${Math.random().toString(36).substr(2,9)}`}createCart({userId:t,oldCartId:a,toMergeCartGuid:r,extraData:i}){const u=this.generateTempCartId();return this.store.dispatch(new _t({extraData:i,userId:t,oldCartId:a,toMergeCartGuid:r,tempCartId:u})),this.getCartIdByType(i?.active?o.EI.ACTIVE:o.EI.NEW_CREATED).pipe((0,S.w)(v=>this.getCart(v)),(0,p.h)(n.pTN))}mergeToCurrentCart({userId:t,cartId:a,extraData:r}){const i=this.generateTempCartId();this.store.dispatch(new ae({userId:t,cartId:a,extraData:r,tempCartId:i}))}loadCart({cartId:t,userId:a,extraData:r}){this.store.dispatch(new y({userId:a,cartId:t,extraData:r}))}getEntries(t){return this.store.pipe((0,E.Ys)(J(t)))}getLastEntry(t,a){return this.store.pipe((0,E.Ys)(J(t)),(0,d.U)(r=>{const i=r.filter(u=>u.product?.code===a);return i?i[i.length-1]:void 0}))}addEntry(t,a,r,i){this.store.dispatch(new nt({userId:t,cartId:a,productCode:r,quantity:i}))}addEntries(t,a,r){r.forEach(i=>{this.store.dispatch(new nt({userId:t,cartId:a,productCode:i.productCode,quantity:i.quantity}))})}removeEntry(t,a,r){this.store.dispatch(new Ut({userId:t,cartId:a,entryNumber:`${r}`}))}updateEntry(t,a,r,i){i>0?this.store.dispatch(new Vt({userId:t,cartId:a,entryNumber:`${r}`,quantity:i})):this.removeEntry(t,a,r)}getEntry(t,a){return this.store.pipe((0,E.Ys)(ye(t,a)))}assignEmail(t,a,r){this.store.dispatch(new te({userId:a,cartId:t,email:r}))}removeCart(t){this.store.dispatch(new B({cartId:t}))}deleteCart(t,a){this.store.dispatch(new ce({userId:a,cartId:t}))}reloadCart(t,a){this.userIdService.takeUserId().subscribe(r=>this.store.dispatch(new y({userId:r,cartId:t,extraData:a})))}getCartIdByType(t){return this.store.pipe((0,E.Ys)(Te(t)),(0,M.x)())}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(E.yh),c.LFG(n.XBV))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),be=(()=>{class e{constructor(t,a,r,i){this.userProfileFacade=t,this.multiCartFacade=a,this.baseSiteService=r,this.userIdService=i}getCart(){return this.selectiveCart$||(this.selectiveCart$=(0,N.aj)([this.getSelectiveCartId(),this.userProfileFacade.get(),this.userIdService.getUserId(),this.baseSiteService.getActive()]).pipe((0,M.x)(),(0,U.b)(([t,a,r,i])=>{!Boolean(t)&&r!==n.Fds&&a?.customerId&&this.multiCartFacade.loadCart({userId:r,cartId:`selectivecart${i}${a.customerId}`})}),(0,p.h)(([t])=>Boolean(t)),(0,S.w)(([t])=>this.multiCartFacade.getCart(t)),(0,Pt.d)({bufferSize:1,refCount:!0}))),this.selectiveCart$}getEntries(){return this.getSelectiveCartId().pipe((0,S.w)(t=>this.multiCartFacade.getEntries(t)))}isStable(){return this.getSelectiveCartId().pipe((0,S.w)(t=>this.multiCartFacade.isStable(t)))}addEntry(t,a){this.getSelectiveIdWithUserId().subscribe(([r,i])=>{this.multiCartFacade.addEntry(i,r,t,a)})}removeEntry(t){this.getSelectiveIdWithUserId().subscribe(([a,r])=>{this.multiCartFacade.removeEntry(r,a,t.entryNumber)})}updateEntry(t,a){this.getSelectiveIdWithUserId().subscribe(([r,i])=>{this.multiCartFacade.updateEntry(i,r,t,a)})}getEntry(t){return this.getSelectiveCartId().pipe((0,S.w)(a=>this.multiCartFacade.getEntry(a,t)))}getSelectiveCartId(){return this.multiCartFacade.getCartIdByType(o.EI.SELECTIVE)}getSelectiveIdWithUserId(){return this.getSelectiveCartId().pipe((0,M.x)(),(0,g.M)(this.userIdService.getUserId()),(0,f.q)(1))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(Xe.aT),c.LFG(o.WT),c.LFG(n.Do$),c.LFG(n.XBV))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();const Tr=[Le,{provide:o.bu,useExisting:Le},Ge,{provide:o.LN,useExisting:Ge},xe,{provide:o.WT,useExisting:xe},be,{provide:o.Oo,useExisting:be},Ve,{provide:o.mU,useExisting:Ve}];let Dr=(()=>{class e extends n.kck{constructor(){super(...arguments),this.responseStatus=n.sdw.BAD_REQUEST}getPriority(){return 0}hasMatch(t){return super.hasMatch(t)&&this.getErrors(t).some(nr)}handleError(t,a){this.handleCartNotFoundError(t,a),this.handleOtherCartErrors(t,a)}handleCartNotFoundError(t,a){this.getErrors(a).filter(r=>_e(r)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.cartNotFound"},n.xUg.MSG_TYPE_ERROR)})}handleOtherCartErrors(t,a){this.getErrors(a).filter(r=>"notFound"!==r.reason||"cart"!==r.subjectType).forEach(r=>{this.globalMessageService.add(r.message?r.message:{key:"httpHandlers.otherCartErrors"},n.xUg.MSG_TYPE_ERROR)})}getErrors(t){return(t.error?.errors||[]).filter(a=>"JaloObjectNoLongerValidError"!==a.type)}}return e.\u0275fac=function(){let s;return function(a){return(s||(s=c.n5z(e)))(a||e)}}(),e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),mr=(()=>{class e extends n.kck{constructor(){super(...arguments),this.responseStatus=n.sdw.BAD_REQUEST}getPriority(){return 0}hasMatch(t){return super.hasMatch(t)&&this.getErrors(t).some(ir)}handleError(t,a){this.handleVoucherExceededError(t,a),this.handleVoucherInvalidError(t,a)}handleVoucherExceededError(t,a){this.getErrors(a).filter(r=>function sr(e){return"coupon.already.redeemed"===e.message}(r)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.voucherExceeded"},n.xUg.MSG_TYPE_ERROR)})}handleVoucherInvalidError(t,a){this.getErrors(a).filter(r=>function ar(e){return"coupon.invalid.code.provided"===e.message}(r)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.invalidCodeProvided"},n.xUg.MSG_TYPE_ERROR)})}getErrors(t){return(t.error?.errors||[]).filter(a=>"JaloObjectNoLongerValidError"!==a.type)}}return e.\u0275fac=function(){let s;return function(a){return(s||(s=c.n5z(e)))(a||e)}}(),e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Pr=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[pr],imports:[Qe.ez,n.vUS,E.Aw.forFeature("cart",Pe,{metaReducers:lr}),h.sQ.forFeature(dr)]}),e})(),Fr=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[Dt,ve,Ie,Ue,...Tr,{provide:n.kck,useExisting:Dr,multi:!0},{provide:n.kck,useExisting:mr,multi:!0}],imports:[yr,Pr,Ar,Mr]}),e})();const Ur=new c.OlP("CartValidationNormalizer");let we=(()=>{class e{constructor(t){this.config=t}isSelectiveCartEnabled(){return Boolean(this.config?.cart?.selectiveCart?.enabled)}isCartValidationEnabled(){return Boolean(this.config?.cart?.validation?.enabled)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(o.qB))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Lr=(()=>{class e{constructor(t,a,r,i,u,v,R){this.cartValidationService=t,this.semanticPathService=a,this.router=r,this.globalMessageService=i,this.activeCartService=u,this.cartValidationStateService=v,this.cartConfigService=R,this.GLOBAL_MESSAGE_TIMEOUT=1e4}canActivate(){return this.cartConfigService.isCartValidationEnabled()?this.cartValidationService.validateCart().pipe((0,g.M)(this.activeCartService.getEntries()),(0,d.U)(([t,a])=>{if(this.cartValidationStateService.updateValidationResultAndRoutingId(t.cartModifications??[]),void 0!==t.cartModifications&&0!==t.cartModifications.length){let r;const i=t.cartModifications[0];return r=1===a.length&&a[0].product?.code===i.entry?.product?.code&&i.statusCode===o.v$.NO_STOCK?{key:"validation.cartEntryRemoved",params:{name:i.entry?.product?.name}}:{key:"validation.cartEntriesChangeDuringCheckout"},this.globalMessageService.add(r,n.xUg.MSG_TYPE_ERROR,this.GLOBAL_MESSAGE_TIMEOUT),this.activeCartService.reloadActiveCart(),this.router.parseUrl(this.semanticPathService.get("cart")??"")}return!0})):(0,D.of)(!0)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(o.mU),c.LFG(n.hCH),c.LFG(Je.F0),c.LFG(n.IWp),c.LFG(o.bu),c.LFG(Oe),c.LFG(we))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Or=(()=>{class e{constructor(t){this.actionsSubject=t}getResults(t){return this.actionsSubject.pipe((0,h.l4)(w,Y),(0,p.h)(a=>a.payload.cartId===t),(0,d.U)(a=>this.mapMessages(a)))}mapMessages(t){const{productCode:a}=t.payload;if(t instanceof ct){const{quantity:r,quantityAdded:i,entry:u,statusCode:v}=t.payload;if(v===o.QX.LOW_STOCK)return{productCode:a,statusCode:v,productName:u?.product?.name,quantity:r,quantityAdded:i};if(v===o.QX.SUCCESS||v===o.QX.NO_STOCK)return{productCode:a,statusCode:v,productName:u?.product?.name}}else if(t instanceof ot){const{error:r}=t.payload;if("UnknownIdentifierError"===r?.details[0]?.type)return{productCode:a,statusCode:o.QX.UNKNOWN_IDENTIFIER}}return(0,c.X6Q)()&&console.warn("Unrecognized cart add entry action type while mapping messages",t),{productCode:a,statusCode:o.QX.UNKNOWN_ERROR}}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(E.UO))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);